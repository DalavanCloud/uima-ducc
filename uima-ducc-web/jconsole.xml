<project name="uima-ducc-web" default="jconsole" basedir=".">
	
	<property name="java_home"  			value="?" />
	
	<property name="unsigned.jar"  			value="jconsole.jar" />
	<property name="wrapper.jar"  			value="jconsole-wrapper.jar" />
	<property name="wrapper.signed.jar"  	value="jconsole-wrapper-signed.jar" />
	
	<property name="tgt.tmp.dir"  			value="${basedir}/tmp" />
	<property name="src.jar"  				value="${java_home}/lib/${unsigned.jar}" />
	<property name="tgt.jar"  				value="${basedir}/lib/${wrapper.jar}" />
	<property name="tgt.signed.jar"  		value="${basedir}/lib/${wrapper.signed.jar}" />
	
	<property name="sub.tree"  				value="/target/classes" />
	
	<property name="package"  				value="/org/apache/uima/ducc/ws/jconsole" />
	<property name="bin.package"  			value="${sub.tree}${package}" />
	<property name="class.dir"  			value="${basedir}${bin.package}" />
	<property name="tgt.dir"  				value="${tgt.tmp.dir}${package}" />
	
	<property name="key.alias"  			value="ducc" />
	<property name="key.storepass"  		value="uima.ducc.org" />
	<property name="key.store"  			value="${tgt.tmp.dir}/.keystore" />
	<property name="key.pass"  				value="uima.ducc.org" />
	
	<property name="webserver.dir"  		value="ducc_runtime/webserver/root/lib/webstart/" />
	
	<target name="jconsole" depends="java-home, clean, setup, fetch, unzip, build, clean-up, install, browser" />
	
	<target name="java-home">
		<echo message="${java_home}"/>
	</target>
	
    <target name="clean">
    	<delete dir="${tgt.tmp.dir}" />
    </target>
	
    <target name="setup">
    	<mkdir dir="${tgt.tmp.dir}" />
    	<mkdir dir="${tgt.dir}" />
    </target>
	
    <target name="fetch">
    	<echo message="unsigned jconsole.jar is expected in ${basedir}/lib/"/>
    </target>
	
    <target name="unzip">
    	<unzip src="${src.jar}" dest="${tgt.tmp.dir}"/>
    </target>
	
    <target name="build" depends="augment, jar-up, gen-key, sign">
    </target>
	
    <target name="augment">
    	<copy todir="${tgt.dir}" overwrite="true">
    		<fileset dir="${class.dir}" />
    	</copy>
    </target>
	
    <target name="jar-up">
    	<jar destfile="${tgt.jar}" basedir="${tgt.tmp.dir}"/>
    </target>
	
    <target name="gen-key">
		<genkey alias="${key.alias}" verbose="true" storepass="${key.storepass}" keypass="${key.pass}" validity="3650" keystore="${key.store}">
    		<dname>
				<param name="CN" value="ducc.org Group"/>
    	        <param name="OU" value="ducc"/>
    	        <param name="O"  value="ducc.org"/>
    	        <param name="C"  value="US"/>
    	    </dname>
    	</genkey>
    </target>
	
    <target name="sign">
    	<signjar jar="${tgt.jar}"
    	  signedjar="${tgt.signed.jar}"
    	  alias="${key.alias}"
    	  storepass="${key.storepass}"
    	  keystore="${key.store}"
    	  keypass="${key.pass}"/>
    </target>
	
    <target name="clean-up">
    	<delete dir="${tgt.tmp.dir}" />
    </target>
	
    <target name="install">
    	<echo message="${basedir}/lib/${wrapper.signed.jar} should be installed into webserver here: ${webserver.dir}${wrapper.signed.jar}"/>
    </target>
	
    <target name="browser">
    	<echo message="To launch webstart application (JConsole links) from browser:"/>
    	<echo message="1. Select Open With and choose another"/>
    	<echo message="2. Navigate to JAVA_HOME/bin and select javaws"/>
    	<echo message="3. Select Do this automatically for files like this from now on"/>
    	<echo message="4. Click OK"/>
    </target>

</project>