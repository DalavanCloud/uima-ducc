<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at
  
       http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
  <!-- ************************************ Logs ********************************** -->
  <section>
    <title>Logs</title>

    <para>
      <emphasis>The source for this chapter is ducc_ducbook/documents/admin/logs.xml</emphasis>
    </para>

    <para>
      There are two sets of DUCC logs:
      <orderedlist>
        <listitem><para>daemon logs</para></listitem>
        <listitem><para>user logs</para></listitem>
      </orderedlist>
    </para>

    <para>
      User logs are <link linkend="ducc.user.logs">described</link> in the User's Guide section of this book.
    </para>

    <para>
      The DUCC logs are managed by <emphasis>log4j</emphasis> and are configured using
      <filename>ducc_runtime/log4j.xml.</filename>  It is not in the scope of this document
      to describe <emphasis>log4j</emphasis> or its configuration mechanism.  Details on <emphasis>log4j</emphasis>
      can be found at <ulink url="http://logging.apache.org/log4j/1.2/">http://logging.apache.org/log4j/1.2/</ulink>.
    </para>

    <para>
      The <emphasis>daemon</emphasis> logs are written by the DUCC administrative
      processes and reside in <filename class="directory">ducc_runtime/logs</filename>.
    </para>

    <para>
      The logs are based on log4j's <emphasis>RollingFileAppender </emphasis> and are configured
      to roll over after they reach a certain size to prevent them from overflowing their disk
      space.  When a log file reaches a maximum size it is renamed and a new generation of log is
      created. The maximum size and the number of generations is configured
      in <filename>ducc_runtime/log4j.xml</filename>.
    </para>

    <para>
      To configure the size and number of generations of files for each log, the following
      parameters, specific to each log, may be updated in <filename>log4j.xml</filename>:
      <variablelist>
        <varlistentry>
          <term><emphasis role="bold">maxBackupIndex</emphasis></term>
          <listitem>
            <para>
              This is the maximum number of generations of the log that will be created.  For example,
              to configure a maximum of 20 generations:
              <screen><![CDATA[<param name="maxBackupIndex" value="20" /> ]]></screen>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">maxFileSize</emphasis></term>
          <listitem>
            <para>
              This is the maximum size of any generation of log file.  For example, to configure the
              maximum to 20 MB:
              <screen><![CDATA[<param name="maxFileSize" value="20MB" /> ]]></screen>
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>

    <para>
      The relevant <emphasis>log4j</emphasis> appenders include:

      <variablelist>
        <varlistentry>
          <term><emphasis role="bold">rmlog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Resource Manager.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">pmlog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Process Manager.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">orlog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Orchestrator.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">smlog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Service Manager.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">wslog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Web Server.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">agentlog</emphasis></term>
          <listitem>
            <para>
              This is the log for the Agents.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>

    </para>

  </section>

