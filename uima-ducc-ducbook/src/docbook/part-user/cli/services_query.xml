<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at
  
       http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
  <!-- ************************************ Service Query ********************************** -->
  <section id="ducc.cli.service.query" xreflabel="ducc_services query">
    <title>ducc_services --query</title>

    <para>
      <emphasis>The source for this section is ducc_ducbook/documents/part-user/cli/service_query.xml</emphasis>
    </para>

    <para>
      <emphasis>Description:</emphasis>
      <variablelist>
        <varlistentry>
          <term  />
          <listitem>

            <para>
              The <emphasis role="bold">query</emphasis> function returns details about all known services
              of all types and classes, including the DUCC ids of the service instances (for submitted
              and registered services), the DUCC ids of the jobs using each service, and a summary of 
              each service's queue and performance statistics, when available.
            </para>

          </listitem>
        </varlistentry>
      </variablelist>
    </para>

    <para>
      <emphasis>Usage:</emphasis>
      <variablelist>
        <varlistentry>
          <term  />
          <listitem>
            <para>
              See the <xref linkend="ducc.cli.service.overview" /> for general usage considerations for
              <emphasis role="bold">ducc_services</emphasis>.
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>

    <para>
      <emphasis>Service Query Options:</emphasis>

      <variablelist>
        <varlistentry>
          <term  />
          <listitem>
            <para>
              <emphasis role="bold">--query [service id]</emphasis>
              <variablelist>
                <varlistentry>
                  <term  />
                  <listitem>
                    <para>
                      This indicates that a service is to be stopped.  The <emphasis role="bold">service id</emphasis>
                      is either the numeric ID assigned by DUCC when the service is registered, or the
                      service endpoint string.
                    </para>
                    
                    <para>
                      If no id is given, information about all services is returned.
                    </para>
                    
                    <para>
                      Example: below is a query against a system with three services.
                    </para>
                    <para>
                      The service with endpoint <emphasis role="bold">UIMA-AS:FixedSleepAE_6:tcp://bluej291:61617</emphasis>
                      is a service submitted outside of DUCC so it is marked as <emphasis>Internal</emphasis> and has
                      no implementing processes tha are known to DUCC.  It is used by job 0 and is active,
                      available, and being actively pinged.  The ActiveMq queue statistics are shown.
                    </para>
                    
                    <para>
                      The service with endpoint <emphasis role="bold">UIMA-AS:FixedSleepAE_5:tcp://bluej291:61617</emphasis>
                      is a registered service, whose registered numeric id is <emphasis role="bold">2</emphasis>. It is
                      registered for two instnaces and no autostart.  Since it is not autostarted, it will be terminated
                      when it is no longer used.  It will linger for 5 seconds after the last referencing job completes, in 
                      case a subsequent job that uses it enters the system (not a realistic linger time!).  It is 
                      currently used (referenced) by DUCC jobs 1 and 5.
                    </para>
                    
                    <para>
                      The service with
                      endpoint <emphasis role="bold">UIMA-AS:FixedSleepAE_1:tcp://bluej291:61617</emphasis>
                      is a submitted service.  It was submitted twice, and so has two implementors,
                      DUCC service jobs 0 and 1.  It is referenced by job 7.  It will continue to run
                      until somebody cancels it, even if it is not used.
                    </para>
                    
                    <para>
                      <screen>
Service: UIMA-AS:FixedSleepAE_6:tcp://bluej291:61617
   Service Class   : Implicit
   Implementors    : (N/A)
   References      : 0 
   Dependencies    : none
   Service State   : Available
   Ping Active     : true
   Autostart       : false
   Manual Stop     : false
   Queue Statistics: 
    Consum   Prod  Qsize  minNQ  maxNQ expCnt inFlgt     DQ     NQ   Disp 
        78    240    170      2  36414      0      0    636    806    636 

Service: UIMA-AS:FixedSleepAE_5:tcp://bluej291:61617
   Service Class   : Registered as ID 2 instances[2] linger[5]
   Implementors    : 9 8 
   References      : 1 5 
   Dependencies    : none
   Service State   : Available
   Ping Active     : true
   Autostart       : false
   Manual Stop     : false
   Queue Statistics: 
    Consum   Prod  Qsize  minNQ  maxNQ expCnt inFlgt     DQ     NQ   Disp 
        52     44      0      0      3      0      0    402    402    402 

Service: UIMA-AS:FixedSleepAE_1:tcp://bluej291:61617
   Service Class   : Submitted
   Implementors    : 1 0 
   References      : 7 
   Dependencies    : none
   Service State   : Available
   Ping Active     : true
   Autostart       : false
   Manual Stop     : false
   Queue Statistics: 
    Consum   Prod  Qsize  minNQ  maxNQ expCnt inFlgt     DQ     NQ   Disp 
        52      0      0      1 1504371      0      0     35     35     35 

                      </screen>
                    </para>    
                    
                  </listitem>
                </varlistentry>
              </variablelist>
            </para>
          </listitem>
        </varlistentry>
      </variablelist>
    </para>

  </section>

