<?xml version="1.0" encoding="UTF-8"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at
  
       http://www.apache.org/licenses/LICENSE-2.0
  
  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
-->
<chapter id="ducc.vm.ov">
  <title>Webserver</title>
  
  <para>
    <emphasis>The source for this chapter is ducc_ducbook/documents/chapter-webserver.xml</emphasis>
  </para>
  
  <para> The DUCC Web Server default address is accessed from the
    URL <filename>http://wshost:42133</filename>.  Each local installation configures the host for
    "wshost" and may override the default port of <emphasis>42133</emphasis>
  </para>
   
  <para>
    The Webserver is designed to be mostly self-documenting.  The design is intentionally simple and
    contains a link to this document.  Column headers and reason/state codes have display a short
    description if you hover your mouse over it.
  </para>

  <para>
    The columns can all be sorted by clicking on the column headers.
  </para>

  <section>
    <title>Common Links</title>

    <para>
      Every page contains a common header containing links and controls.  The links permit navigation to other 
      content at the site.  The controls provide page-wise configuration of the content at that page.
    </para>

    <para>
      The following links are available on every page of the web server:
      <variablelist>
        <varlistentry>
          <term><emphasis role="bold">Authentication</emphasis></term>
          <listitem>
            <simplelist>
              <member>Login - Authenticate and start a session with the Web Server.</member>
              <member>Logout - Terminate the Web Server session</member>
            </simplelist>
            <note><para>Authentication is in order to <emphasis>cancel</emphasis>
            jobs and reservations, to create a reservation, and to perform administration.
                It is not required to simply view the pages.</para>
            </note>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">DuccBook</emphasis></term>
          <listitem>
            <para>
            This is a link to the HTML version of the documnet you are reading.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Jobs</emphasis></term>
          <listitem>
            <para>
            This navigates to the Jobs page, showing all the jobs in the system.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Reservations</emphasis></term>
          <listitem>
            <para>
            This navigates to the Reservations page, showing all the reservations in the system and
            provides a button that can be used to request new reservations.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Services</emphasis></term>
          <listitem>
            <para>
            This navigates to the Services page, showing all the services in the system.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">System</emphasis></term>
          <listitem>
            <para>
            This opens a submenu with system-related links:
            <simplelist>
              <member>Administration - This opens a page with administrative functions.</member>
              <member>Classes - This shows all the scheduling classes defined to the system.</member>
              <member>Daemons - This shows the status of DUCC's management processes.</member>
              <member>DuccBook - This manual.</member>
              <member>Machines - This shows the status of all the ducc worker nodes.</member>
            </simplelist>
            </para>
          </listitem>
        </varlistentry>

      </variablelist>
    </para>
  </section>

  <section>
    <title>Jobs Page</title>
    <para>
      The Web Server's home page is also the Jobs page. This page has links to all the rest of the content
      at the site and shows the status of all the jobs in the system.
    </para>

    <para>
      The Jobs page contains the following columns:

      <variablelist>

        <varlistentry>
          <term><emphasis role="bold">Id</emphasis></term>
          <listitem>
            <para>
              This is the ID as assigned by DUCC.  This field is hyperlinked to a "Job Details" page that shows the breakdown
              of all the processes assigned to the job and their state. 
            </para>
          </listitem>

        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Start</emphasis></term>
          <listitem><para>This is the time the Job is accepted into DUCC.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">End</emphasis></term>
          <listitem><para>This is the time the Job completes.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">User</emphasis></term>
          <listitem><para>This is the userid of the job owner.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Class</emphasis></term>
          <listitem><para>This is the resource class the job is submitted to.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">State</emphasis></term>
          <listitem>
            <para>
              This shows the state of the job.
              States include:
              <simplelist>
                <member><emphasis role="bold">Received</emphasis> - The jobhas ben vetted, persisted, and assigned a unique ID.</member>
                <member><emphasis role="bold">WaitingForDriver</emphasis> - The job is waiting for the Job Driver to initialize.</member>
                <member><emphasis role="bold">WaitingForServices</emphasis> - The job is waiting to verify that any declared services are available.</member>
                <member><emphasis role="bold">WaitingForResources</emphasis> - The job is waiting to be scheduled.</member>
                <member><emphasis role="bold">Initializing</emphasis> - The job is in its initializaiton phase.</member>
                <member><emphasis role="bold">Running</emphasis> - At least one process is now initialized and running.</member>
                <member><emphasis role="bold">Completing</emphasis> - The last process has finished and the job is cleaning up.</member>
                <member><emphasis role="bold">Completed</emphasis> - The job is complete.</member>
              </simplelist>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Reason</emphasis></term>
          <listitem>
            <para>
              This is information relating to completion state.
              <simplelist>
                <member><emphasis role="bold">EndOfJob</emphasis> - The job ran with no errors.</member>

                <member><emphasis role="bold">Error</emphasis> - All work items are processes but at
                  least one had an error.</member>

                <member><emphasis role="bold">CanceledByDriver</emphasis> - The Job Driver (JD)
                  terminated the job. The reason for termination is seen by hovering over the text
                  with your mouse.</member>

                <member><emphasis role="bold">CanceledBySystem</emphasis> - The job was canceled
                  because DUCC was shutdown.</member>

                <member><emphasis role="bold">CanceledBySser</emphasis> - The job owner or DUCC
                  administator canceled the job.</member>

                <member><emphasis role="bold">DriverInitializationFailure</emphasis> - The Job
                  Deiver (JD) process is unable to initialize.  Hover over the field with your mouse
                  for details (if any are available), and check your JD log.</member>

                <member><emphasis role="bold">DriverProcessFailed</emphasis> - The Job Driver (JD)
                  process failed for some reason.  Hover over the field with your mouse for details (if any), and
                  check your JD log.</member>

                <member><emphasis role="bold">ServicesUnavailable</emphasis> - The job declared a
                  dependency on one or more services, and the Service Manager (SM) cannot find or
                  start the required service.</member>

                <member><emphasis role="bold">Premature</emphasis> - The job was terminated for some
                  unknown reason before all work items were processed.  Check the JP logs for details.</member>

                <member><emphasis role="bold">ProcessInitializationFailure</emphasis> - Too many
                  processes failed during initialization.  Check the JP logs for the reason.</member>

                <member><emphasis role="bold">ProcessFailure</emphasis> - Too many
                  processes failed while running.  Check the JP logs for the reason.</member>

                <member><emphasis role="bold">ResourcesUnavailable</emphasis> - The Resource Manager (RM) is 
                  unable to allocate resources for the job. For non-preemptable jobs this could be because
                  the limit on that type of allocaiton is reached, or all the nodes are already allocated
                  and work cannot be preempted to make space for it.  For all jobs, it could be because the
                  job class is invalid.</member>
                
              </simplelist>
            </para>
          </listitem>            
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Processes</emphasis></term>
          <listitem><para>This is the number of processes currently assigned to the job.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Init Fails</emphasis></term>
          <listitem>
            <para>
              This is the total number of initialization failures experienced by the job. This field is hyperlinked to
              pages showing the specific failures.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Run Fails</emphasis></term>
          <listitem>
            <para>
              This is the total number of process failures experienced by the job. This field is hyperlinked to a
              page showing the specific failures.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Size</emphasis></term>
          <listitem><para>This is the declared memory size of the job</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Total</emphasis></term>
          <listitem><para>This is the total number of work items declared by the job.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Done</emphasis></term>
          <listitem><para>This is the total number of work items successfuly completed for the job.</para></listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Error</emphasis></term>
          <listitem>
            <para>
              This is the total number of exceptions thrown or other errors experienced by work
              items. This field is hyperlinked to a page showing the specific failures.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Dispatch</emphasis></term>
          <listitem>
            <para>
              This is the total number CASs that are currently dispatched.  This is usally
              min(Processes * Threads, incomplete_work_items - errors) 
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Retry</emphasis></term>
          <listitem>
            <para>
              This is the number of CASs that were retried for any reason (such as
              timeout).
            </para>
          </listitem>
        </varlistentry>


        <varlistentry>
          <term><emphasis role="bold">Preempt</emphasis></term>
          <listitem>
            <para>
              This is the total number of processes that have been preempted to make room
              for other work due to Fair Share.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Description</emphasis></term>
          <listitem>
            <para>
              This is the descriptin string from the <emphasis>--description</emphasis>
              string from submit. 
            </para>
          </listitem>
        </varlistentry>


      </variablelist>
    </para>
  </section>

  <section>
    <title>Job Details Page</title>
    <para>
      This page shows details of all the processes that run in support of a job.
    </para>

    <para>
      The Jobs page contains the following columns:

      <variablelist>

        <varlistentry>
          <term><emphasis role="bold">Id</emphasis></term>
          <listitem>
            <para>
              This is the DUCC process id (not the Operating System's processid).  Process 0 is alwyas the
              Job Driver.  It is hyperlinked to <emphasis>jd.out.log</emphasis>.
            </para>
          </listitem>

        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Log</emphasis></term>
          <listitem>
            <para>
              This is the log name for the process.  It is hyperlinked to the log itself.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Size</emphasis></term>
          <listitem>
            <para>
              This is the size of the log in MB.  If you find you have trouble viewing the
              log from the web server it could be because it is too big to view in the server and
              needs to be check directly.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Hostname</emphasis></term>
          <listitem>
            <para>
              This is the name of the node where the process ran.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">PID</emphasis></term>
          <listitem>
            <para>
              This is the Operating Systems' PID for the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">State:Scheduler</emphasis></term>
          <listitem>
            <para>
              This shows the Resesource Manager state of the job.  It is one of:
              <simplelist>
                <member><emphasis role="bold">Allocated</emphasis> - The node is still allocated for this job by the RM</member>
                <member><emphasis role="bold">Deallocated</emphasis> - The resource manager has deallocated the shares for the job on this node.</member>
              </simplelist>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Reason:Scheduler</emphasis></term>
          <listitem>
            <para>
              This shows why a process is terminated, from the system's point of view.
              <simplelist>
                <member><emphasis role="bold">AutonomousStop</emphasis> - The process terminated
                  unexpectedly of its own accord ("crashed") for no detectable reason.. </member>
                <member><emphasis role="bold">JobCanceled</emphasis> - The job was canceled by the user or a system administrator.</member>
                <member><emphasis role="bold">JobCompleted</emphasis> - The process is canceled because of DUCC restart.</member>
                <member><emphasis role="bold">JobFailure</emphasis> - The job failure limit is exceeded, causing the job to be canceled by the JD.</member>
                <member><emphasis role="bold">Exception</emphasis> - The process is terminated by the JD exception handler.</member>
                <member><emphasis role="bold">Failed</emphasis> - The process is terminated by the
                  Agent because the JP wrapper was able to detect and communicate a fatal condition
                  (Exception) in the pipeline..</member>
                <member><emphasis role="bold">FailedInitialization</emphasis> - The process is terminated because the initialization step failed.</member>
                <member><emphasis role="bold">Forced</emphasis> - The node is preempted by RM for other work because of fair share.</member>
                <member><emphasis role="bold">InitializationTimeout</emphasis> - The initialization phase exceeded the configured timeout.</member>
                <member><emphasis role="bold">Killed</emphasis> - The agent terminated the process for some reason.</member>
                <!--
                    <member><emphasis role="bold">Purged</emphasis> - The node with the process exceeded its heartbeat threshold and is deactivated by the RM.</member>
                    -->
                <member><emphasis role="bold">Stopped</emphasis> - The job is winding down, there's no more work for this node, so it stops.</member>
                <member><emphasis role="bold">Voluntary</emphasis> - The job is winding down, there's no more work for this node, so it stops.</member>
                <member><emphasis role="bold">Unknown</emphasis> - None of the above.  This is an
                  exceptional condition.  Check the JP and JD logs for possible causes..</member>


              </simplelist>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">State:Agent</emphasis></term>
          <listitem>
            <para>
              If there's an error detected only by the agent, this shows the Agent's reason for a process's death.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Reason:Agent</emphasis></term>
          <listitem>
            <para>
              If there's an error detected only by the agent, this shows the Agent's reason for a process's death.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Time:Init</emphasis></term>
          <listitem>
            <para>
              This is the clock time this process spent in initializaiton.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Time:Run</emphasis></term>
          <listitem>
            <para>
              This is the clock time this process spent in executing, not including initialization.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Time:GC</emphasis></term>
          <listitem>
            <para>This is amount of time spent in Java Garbage Collection for the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Count:GC</emphasis></term>
          <listitem>
            <para>
              This is the number of garbage collections performed by the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">%GC</emphasis></term>
          <listitem>
            <para>
              Process percentage of time spent in garbage collections, relative to total of
              initialization + run times.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">CPU</emphasis></term>
          <listitem>
            <para>
              Cumulative CPU time for the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">%RSS</emphasis></term>
          <listitem>
            <para>
              Resident Storage Size, as a percentage of process memory requirement in job specification.
            </para>
          </listitem>
        </varlistentry>


        <varlistentry>
          <term><emphasis role="bold">Time:Avg</emphasis></term>
          <listitem>
            <para>
              Average seconds spent per work item in the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Time:min</emphasis></term>
          <listitem>
            <para>
              This is the minimum time spent per work item in the process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Time:max</emphasis></term>
          <listitem>
            <para>
              This is the minimum time spent per work item in theprocess.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Done</emphasis></term>
          <listitem>
            <para>
              This is the number of work items processed in this process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Error</emphasis></term>
          <listitem>
            <para>
              This is the number of exceptions processing work items in this process.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Retry</emphasis></term>
          <listitem>
            <para>
              This is the number of work items that were retried for any reason, excluding
              preemptions.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Preempt</emphasis></term>
          <listitem>
            <para>
              This is the number of work items that had to be retried because of preemption.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">JConsole URL</emphasis></term>
          <listitem>
            <para>
              This is a URL that can be used to connect via JMX to the processes, e.g. via jconsole.
            </para>
          </listitem>
        </varlistentry>
        
      </variablelist>
    </para>
  </section>

  <section>
    <title>Reservation Details Page</title>
    <para>
      This page shows details of all reservations.
    </para>

    <para>
      The Reservations page contains the following columns:

      <variablelist>

        <varlistentry>
          <term><emphasis role="bold">Id</emphasis></term>
          <listitem>
            <para>
              This is the DUCC process id of the reservation as provided when the reservation is made.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Start</emphasis></term>
          <listitem>
            <para>
              This is the time the reservation was mde.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">End</emphasis></term>
          <listitem>
            <para>
              This is the time the reservation was canceled.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">User</emphasis></term>
          <listitem>
            <para>
              This is the userid if the person who made the reservation.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Class</emphasis></term>
          <listitem>
            <para>
              This is the resource class used to schedule the reservation.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Status</emphasis></term>
          <listitem>
            <para>
              This is the status of the reservation.  Values include:
              <simplelist>
                <member><emphasis role="bold">Received</emphasis> - Reservation has been vetted, persisted, and assigned unique Id.</member>
                <member><emphasis role="bold">WaitingForResources</emphasis> - The reservation is waitng for the Resource Manager to find
                  and schedule resources.</member>
                <member><emphasis role="bold">Assigned</emphasis> - The reservation is active.</member>
                <member><emphasis role="bold">Completed</emphasis> - The reservation has been canceled.</member>
              </simplelist>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Reason</emphasis></term>
          <listitem>
            <para>
              If a reservation is not active, the reason.  Reasons include:
              <simplelist>
                <member><emphasis role="bold">ResourcesUnavailable</emphasis> - The Resource Manager was unable to find free or
                  freeable resources to match the resource request.</member>
                <member><emphasis role="bold">CanceledBySystem</emphasis> - The job was canceled because DUCC was shutdown.</member>
                <member><emphasis role="bold">CanceledByUser</emphasis> - The owner or administrator released the reservation. </member>
              </simplelist>
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Allocation</emphasis></term>
          <listitem>
            <para>
              The number of resources (shares for FIXED policy reservartions, processes for RESERVE policy reservations) that
              are allocated.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Size</emphasis></term>
          <listitem>
            <para>
              The memory size in GB of the each allocated unit.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">List</emphasis></term>
          <listitem>
            <para>
              The node names of the machines where the resource is allocated.
            </para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term><emphasis role="bold">Description</emphasis></term>
          <listitem>
            <para>
              This is the descriptin string from the <emphasis>--description</emphasis>
              string from submit. 
            </para>
          </listitem>
        </varlistentry>

      </variablelist>
    </para>
  </section>
       
</chapter>
